#!/usr/bin/env python3

from requests_html import HTMLSession
from tools import *

session = HTMLSession()

school_scrape = session.get('https://login.mymaths.co.uk') # Initial GET for cookie

s_name, s_pass = input('School Login\nUsername: '), input('Password: ')
form = getFormData(school_scrape, {'account[user_name]': s_name, 'account[password]': s_pass}) 

print('Attempting school login...')
school_login = session.post('https://login.mymaths.co.uk', data=form) # School Login POST
if 'My portal' in school_login.text:
	print('Success!')
else:
	print('Failed, aborting!')
	exit()

s_name, s_pass = input('Student Login\nUsername: '), input('Password: ')
form = getFormData(school_login, {'student[user_name]': s_name, 'student[password]': s_pass})

print('Attempting student login...')
student_login = session.post('https://app.mymaths.co.uk/myportal/student/authenticate', data=form) # Student Login POST
if 'My Homework' in student_login.text:
	print('Success!')
else:
	print('Failed, aborting!')
	exit()

# Now logged in!!!

text = student_login.text
name = text[text.index('student-name pull-left'):].split('<')[0].split('>')[1]
print('Logged in as ' + name + '.')

#!/usr/bin/env python3

# 1) GET https://login.mymaths.co.uk to get the cookie
# 2) POST https://login.mymaths.co.uk with school login
# 3) POST https://app.mymaths.co.uk/myportal/student/authenticate with student login
# 4) Extract the tasks
# 5) Complete the tasks

from requests_html import HTMLSession
from tools import *

Session = HTMLSession()

# Grab the cookie + get the login form
cookie_grab = Session.get('https://login.mymaths.co.uk')
print('School Login ---')
school_form = constructLoginForm(cookie_grab.text, input('Username: '), input('Password: '))

# School login + get login form

school_grab = Session.post('https://login.mymaths.co.uk', data=school_form)
print('Student Login ---')
student_form = constructLoginForm(school_grab.text, input('Username: '), input('Password: '))

# Student login
student_grab = Session.post('https://app.mymaths.co.uk/myportal/student/authenticate', data=student_form)

try:
    print('Logged in as:', getStudentName(student_grab.text), ':)')
except:
    print('Log in failed :(')
    exit()

# Now logged in!!

tasks = getTaskLinks(student_grab.text)
tasks_len = len(tasks)
print(f"There are {tasks_len or 'no'} homework tasks!")
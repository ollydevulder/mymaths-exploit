#!/usr/bin/env python3

import requests
from tools import *

# Generate random User Agent
user_agent = getUserAgent()

# GET login.mymaths for session ID and form data
school_scrape = requests.get('https://login.mymaths.co.uk')

s_name, s_pass = input('School Login\nUsername: '), input('Password: ')
form = getFormData(school_scrape, {'account[user_name]': s_name, 'account[password]': s_pass})
headers = {'User-Agent': user_agent, 'Cookie': getCookie(school_scrape, 'mymaths_session_id')}

print('Attempting school login...')
school_login = requests.post('https://login.mymaths.co.uk', data=form, headers=headers) # SCHOOL LOGIN
if 'My portal' in school_login.text:
	print('Success!')
else:
	print('Failed, aborting!')
	exit()

s_name, s_pass = input('Student Login\nUsername: '), input('Password: ')
form = getFormData(school_login, {'student[user_name]': s_name, 'student[password]': s_pass})
headers['Cookie'] = getCookie(school_login, 'mymaths_session_id')

print('Attempting student login...')
student_login = requests.post('https://app.mymaths.co.uk/myportal/student/authenticate', data=form, headers=headers) # STUDENT LOGIN
if 'My Homework' in student_login.text:
	print('Success!')
else:
	print('Failed, aborting!')
	exit()

# Now logged in!!!

text = student_login.text
name = text[text.index('name"')+6:].split('<')[0]
print('Logged in as 'name + '.')


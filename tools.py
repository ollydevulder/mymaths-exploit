# Functions for extracting info from scraped pages

import re
import random

if __name__ == "__main__":
	print("I'm a library, silly!")
	exit()

def getFormData(res, extra={}):
	"""
	requests response object
	[other stuff to add (like username or password)]
	"""
	page = res.text
	# form has id 'loginform'
	page = page[page.index('loginform'):]
	page = page[page.index('>')+1:page.index('</form')].replace('\n', '')
	inputs = [s for s in page.split('>') if 'value' in s]
	form = {}
	for i in inputs:
		nameI = i.index('name') + 6
		valueI = i.index('value') + 7
		name = i[nameI:].split('"')[0]
		value = i[valueI:].split('"')[0]
		form[name] = value
	for e in extra:
		form[e] = extra[e]
	return form

# Stuff for mark request

charset = [chr(a) for a in range(65,91)] + [chr(a) for a in range(97,122)] + ['.', '-', '_']

def getCodes():
	global charset
	sCode = ''.join([str(random.randint(0,9)) for _ in range(13)])
	authToken = ''.join([random.choice(charset) for _ in range(153)])
	return {'sCode': sCode, 'authToken': authToken}

def getIds(res):
	"""
	requests response object
	"""
	page = res.text
	i = page.index('studentID=') + len('studentID=')
	j = page[i:].index('&')
	studentID = page[i:i+j]
	i = page.index('taskID=') + len('taskID=')
	j = page[i:].index("'")
	taskID = page[i:i+j]
	return {'studentID': studentID, 'taskID': taskID}

def getMarkForm(res):
	return dict(getCodes(), **getIds(res))
